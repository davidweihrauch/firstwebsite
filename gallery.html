
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gallery</title>
<style>
  :root {
    --gap: 10px;
    --tile-min: 160px;
    --radius: 10px;
    --bg: #0b0d0f; --card: #14171a; --text: #e8eaed;
  }
  * { box-sizing: border-box; }
  body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
         background: var(--bg); color: var(--text); }
  header { padding: 20px; text-align: center; }
  .gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(var(--tile-min), 1fr));
    gap: var(--gap);
    padding: var(--gap);
    max-width: 1200px; margin: 0 auto 60px;
  }
  figure { margin:0; background: var(--card); border-radius: var(--radius); overflow:hidden; cursor:zoom-in;
           box-shadow: 0 6px 20px rgba(0,0,0,.25); }
  figure img { width:100%; height: 200px; object-fit: cover; display:block; transition: transform .25s ease; }
  figure:hover img { transform: scale(1.03); }
  @media (min-width:768px){ figure img { height: 220px; } }
  @media (min-width:1024px){ figure img { height: 240px; } }
  .lightbox { position: fixed; inset: 0; display:none; align-items:center; justify-content:center;
              background: rgba(0,0,0,.85); padding:2vw; z-index: 9999; }
  .lightbox.open { display:flex; }
  .lightbox img { max-width: min(95vw, 1400px); max-height: 95vh; border-radius: var(--radius);
                  box-shadow: 0 20px 60px rgba(0,0,0,.5); }
  .lightbox button.close { position:absolute; top:10px; right:10px; border:0; background: rgba(255,255,255,.15);
                           color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; }
</style>
</head>
<body>
  <header>
    <h1>Gallery</h1>
    <p style="opacity:.7">Tap any image to view it larger</p>
  </header>

  <main>
    <section class="gallery" id="gallery" aria-label="Image gallery"></section>
  </main>

  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Image viewer">
    <button class="close" type="button" aria-label="Close">Close âœ•</button>
    <img id="lightboxImg" alt="">
  </div>


<script>
(async function(){
  const gallery   = document.getElementById('gallery');
  const lightbox  = document.getElementById('lightbox');
  const lightImg  = document.getElementById('lightboxImg');
  const closeBtn  = lightbox.querySelector('button.close');

  // Compute repo base for GitHub Project Pages (e.g., /repo-name/)
  const parts = location.pathname.split('/').filter(Boolean);
  const repoBase = parts.length > 0 ? `/${parts[0]}/` : '/';

  // Resolve URLs robustly for both User sites and Project Pages
  function resolveUrl(u) {
    if (!u) return '';
    if (/^https?:\/\//i.test(u)) return u;        // external URL
    if (u.startsWith('/')) {                       // absolute from domain root
      // Map to repo base if we're on a Project Page
      const isProject = parts.length > 0;
      return isProject ? repoBase + u.replace(/^\//, '') : u;
    }
    // Relative to current page (root)
    return new URL(u, location.href).toString();
  }

  let res;
  try { res = await fetch('./gallery.json', { cache: 'no-cache' }); }
  catch (err) {
    console.error('Network error loading gallery.json:', err);
    gallery.innerHTML = '<p style="opacity:.7">Network error loading gallery.json</p>';
    return;
  }
  if (!res.ok) {
    console.error('Failed to load gallery.json', res.status, res.statusText);
    gallery.innerHTML = '<p style="opacity:.7">Could not load gallery.json.</p>';
    return;
  }

  let urls;
  try { urls = await res.json(); }
  catch (err) {
    console.error('JSON parse error. Check gallery.json.', err);
    gallery.innerHTML = '<p style="opacity:.7">Invalid gallery.json format.</p>';
    return;
  }

  for (const original of urls) {
    const url = resolveUrl(original);
    const fig = document.createElement('figure');
    fig.dataset.full = url;

    const img = document.createElement('img');
    img.src = url;
    img.loading = 'lazy';
    img.decoding = 'async';
    img.alt = (original || '').split('/').pop()?.replace(/\.[^.]+$/,'').replace(/[-_]/g,' ') || 'image';

    // Log broken images so you can click and check the resolved path
    img.addEventListener('error', () => {
      console.error('Image failed:', { original, resolved: url });
      img.alt = 'Image failed to load';
      img.style.opacity = '0.6';
    });

    fig.appendChild(img);
    fig.addEventListener('click', () => openLightbox(url, img.alt));
    gallery.appendChild(fig);
  }

  function openLightbox(src, alt) {
    lightImg.src = src;
    lightImg.alt = alt || '';
    lightbox.classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  function closeLightbox() {
    lightbox.classList.remove('open');
    lightImg.src = '';
    document.body.style.overflow = '';
  }
  closeBtn.addEventListener('click', closeLightbox);
  lightbox.addEventListener('click', (e)=>{ if (e.target === lightbox) closeLightbox(); });
  window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeLightbox(); });
})();
</script>

</body>
</html>

